<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>User Management</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" th:href="@{/css/app.css}" href="/css/app.css">
  <style>
    body {
      font-family: "Manrope", ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    @keyframes riseIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .reveal {
      animation: riseIn 0.6s ease-out both;
    }
    .reveal.delay-1 { animation-delay: 0.05s; }
    .reveal.delay-2 { animation-delay: 0.1s; }
    .reveal.delay-3 { animation-delay: 0.15s; }
  </style>
</head>

<body class="bg-slate-100 text-slate-900">
  <div class="absolute inset-0 -z-10 pointer-events-none">
    <div class="absolute -top-32 -right-24 h-80 w-80 rounded-full bg-emerald-200/30 blur-3xl"></div>
    <div class="absolute top-40 -left-24 h-96 w-96 rounded-full bg-slate-200/60 blur-3xl"></div>
    <div class="absolute -bottom-32 right-10 h-96 w-96 rounded-full bg-amber-200/30 blur-3xl"></div>
  </div>

  <div class="min-h-screen relative">
    <!-- Header -->
    <header class="bg-white/80 backdrop-blur border-b border-slate-200 sticky top-0 z-40">
      <div class="w-full px-6 lg:px-10 py-5">
        <div class="grid grid-cols-[auto_1fr_auto] items-center gap-4">
          <div class="flex items-center gap-3">
            <div class="h-10 w-10 rounded-xl bg-slate-900 text-white grid place-items-center shadow-sm">
              <svg viewBox="0 0 24 24" class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M16 11a4 4 0 1 0-8 0 4 4 0 0 0 8 0z"/>
                <path d="M3 20a7 7 0 0 1 18 0"/>
              </svg>
            </div>
            <div>
              <div class="text-xl sm:text-2xl font-bold leading-tight">User Management</div>
              <div class="text-sm text-slate-500">Enterprise-grade access control and auditing</div>
            </div>
          </div>

                    <nav th:replace="~{fragments/navigation :: mainNav}"></nav>

          <div class="flex items-center justify-end gap-2">
            <a sec:authorize="isAnonymous()" href="/login"
               class="rounded-xl border border-slate-200 px-4 py-2 bg-white hover:bg-slate-50 transition">
              Login
            </a>
            <form sec:authorize="isAuthenticated()" action="/logout" method="post" class="m-0">
              <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
              <button class="rounded-xl border border-slate-200 px-4 py-2 bg-white hover:bg-slate-50 transition">
                Logout
              </button>
            </form>
          </div>
        </div>
      </div>
    </header>

    <main class="w-full px-6 lg:px-10 py-8">
      <div class="mb-6 flex justify-end">
        <a href="/"
           class="rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm font-medium hover:bg-slate-50 transition">
          Dashboard
        </a>
      </div>

      <div class="mb-6">
        <div th:if="${success}"
             class="mb-4 rounded-xl border border-emerald-200 bg-emerald-50 px-4 py-3 text-sm text-emerald-700">
          <div class="font-semibold">Success</div>
          <div class="mt-0.5" th:text="${success}">Action completed.</div>
        </div>
        <div th:if="${error}"
             class="mb-4 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700">
          <div class="font-semibold">Action failed</div>
          <div class="mt-0.5" th:text="${error}">Something went wrong.</div>
        </div>
      </div>

      <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
        <div class="xl:col-span-1 space-y-6">
          <div class="rounded-2xl border border-slate-200 bg-white shadow-sm p-6 reveal">
            <div class="text-sm text-slate-500">Total users</div>
            <div class="mt-2 text-3xl font-semibold text-slate-900" th:text="${totalUsers}">0</div>
            <div class="mt-4 grid grid-cols-3 gap-3 text-xs text-slate-500">
              <div class="rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-center">
                <div class="text-[10px] uppercase tracking-wide">Admins</div>
                <div class="mt-1 text-sm font-semibold text-slate-900" th:text="${adminCount}">0</div>
              </div>
              <div class="rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-center">
                <div class="text-[10px] uppercase tracking-wide">Managers</div>
                <div class="mt-1 text-sm font-semibold text-slate-900" th:text="${managerCount}">0</div>
              </div>
              <div class="rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-center">
                <div class="text-[10px] uppercase tracking-wide">Cashiers</div>
                <div class="mt-1 text-sm font-semibold text-slate-900" th:text="${cashierCount}">0</div>
              </div>
            </div>
          </div>

          <div id="new-user" class="rounded-2xl border border-slate-200 bg-white shadow-sm p-6 reveal delay-1">
            <div class="text-base font-semibold">Add new user</div>
            <div class="text-sm text-slate-500">Create cashier or manager accounts with flags</div>
            <form action="/users" method="post" class="mt-4 space-y-3">
              <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
              <div>
                <label class="block text-xs font-medium text-slate-600 mb-1">Username</label>
                <input name="username" type="text" autocomplete="off"
                       class="w-full rounded-xl border border-slate-200 px-3 py-2.5 bg-white
                              focus:outline-none focus:ring-2 focus:ring-slate-300"
                       placeholder="e.g. cashier01" required/>
              </div>
              <div>
                <label class="block text-xs font-medium text-slate-600 mb-1">Password</label>
                <input name="password" type="password" autocomplete="new-password"
                       class="w-full rounded-xl border border-slate-200 px-3 py-2.5 bg-white
                              focus:outline-none focus:ring-2 focus:ring-slate-300"
                       placeholder="Set a temporary password" required/>
              </div>
              <div>
                <label class="block text-xs font-medium text-slate-600 mb-1">Role</label>
                <select name="role"
                        class="w-full rounded-xl border border-slate-200 px-3 py-2.5 bg-white
                               focus:outline-none focus:ring-2 focus:ring-slate-300">
                  <option th:each="r : ${roles}" th:value="${r}" th:text="${r}"></option>
                </select>
              </div>
              <div class="grid grid-cols-2 gap-3">
                <div>
                  <label class="block text-xs font-medium text-slate-600 mb-1">Status</label>
                  <select name="active"
                          class="w-full rounded-xl border border-slate-200 px-3 py-2.5 bg-white
                                 focus:outline-none focus:ring-2 focus:ring-slate-300">
                    <option value="true" selected>Active</option>
                    <option value="false">Inactive</option>
                  </select>
                </div>
                <div>
                  <label class="block text-xs font-medium text-slate-600 mb-1">Require reset</label>
                  <select name="mustResetPassword"
                          class="w-full rounded-xl border border-slate-200 px-3 py-2.5 bg-white
                                 focus:outline-none focus:ring-2 focus:ring-slate-300">
                    <option value="true" selected>Yes</option>
                    <option value="false">No</option>
                  </select>
                </div>
              </div>
              <div>
                <label class="block text-xs font-medium text-slate-600 mb-1">MFA required</label>
                <select name="mfaRequired"
                        class="w-full rounded-xl border border-slate-200 px-3 py-2.5 bg-white
                               focus:outline-none focus:ring-2 focus:ring-slate-300">
                  <option value="false" selected>No</option>
                  <option value="true">Yes</option>
                </select>
              </div>
              <div>
                <label class="block text-xs font-medium text-slate-600 mb-2">Permissions</label>
                <div class="grid grid-cols-2 gap-2">
                  <label th:each="p : ${permissions}" class="flex items-center gap-2 rounded-lg border border-slate-200 px-2 py-1.5 text-xs text-slate-700">
                    <input type="checkbox" name="permissions" th:value="${p}" class="rounded border-slate-300"/>
                    <span th:text="${p}">PERMISSION</span>
                  </label>
                </div>
              </div>
              <button class="w-full rounded-xl bg-slate-900 text-white py-2.5 text-sm font-semibold
                             hover:bg-slate-800 transition active:scale-[0.99]">
                Create User
              </button>
            </form>
          </div>

          <div class="rounded-2xl border border-slate-200 bg-white shadow-sm p-6 reveal delay-2">
            <div class="flex items-center justify-between gap-2">
              <div>
                <div class="text-base font-semibold">Audit log</div>
                <div class="text-sm text-slate-500">Recent role, password, and access changes</div>
              </div>
              <div class="flex items-center gap-2">
                <a href="/admin/audit?actionType=LOGIN_PASSWORD_HELP_REQUEST"
                   class="rounded-xl border border-amber-200 bg-amber-50 px-3 py-1.5 text-xs font-semibold text-amber-700 hover:bg-amber-100 transition">
                  Password help requests
                </a>
                <a href="/admin/audit"
                   class="rounded-xl border border-slate-200 bg-white px-3 py-1.5 text-xs font-semibold text-slate-700 hover:bg-slate-50 transition">
                  View full log
                </a>
              </div>
            </div>
            <div class="mt-4 space-y-3 max-h-96 overflow-y-auto">
              <div th:each="log : ${auditLogs}" class="rounded-xl border border-slate-200 bg-slate-50 px-4 py-3">
                <div class="flex items-center justify-between text-xs text-slate-500">
                  <span th:text="${#temporals.format(log.createdAt, 'yyyy-MM-dd HH:mm')}">2026-02-11 18:00</span>
                  <span class="rounded-full bg-slate-200 px-2 py-0.5 text-[10px] font-semibold text-slate-700" th:text="${log.action}">ACTION</span>
                </div>
                <div class="mt-2 text-sm font-semibold text-slate-900" th:text="${log.details}">Details</div>
                <div class="mt-1 text-xs text-slate-600">
                  <span class="font-medium" th:text="${log.actorUsername}">actor</span>
                  <span class="text-slate-400">â†’</span>
                  <span th:text="${log.targetUsername}">target</span>
                </div>
              </div>
              <div th:if="${#lists.isEmpty(auditLogs)}" class="text-sm text-slate-500">No audit activity yet.</div>
            </div>
          </div>
        </div>

        <div class="xl:col-span-2 space-y-6">
          <div class="rounded-2xl border border-slate-200 bg-white shadow-sm p-6 reveal delay-1">
            <div class="text-base font-semibold">Search &amp; filters</div>
            <div class="text-sm text-slate-500">Filter by username, role, or account status</div>
            <form action="/users" method="get" class="mt-4 grid grid-cols-1 md:grid-cols-4 gap-3">
              <div class="md:col-span-2">
                <label class="block text-xs font-medium text-slate-600 mb-1">Search</label>
                <input name="q" type="text" th:value="${q}"
                       class="search-pill-input w-full"
                       placeholder="Search username"/>
              </div>
              <div>
                <label class="block text-xs font-medium text-slate-600 mb-1">Role</label>
                <select name="role"
                        class="w-full rounded-xl border border-slate-200 px-3 py-2.5 bg-white
                               focus:outline-none focus:ring-2 focus:ring-slate-300">
                  <option value="" th:selected="${role == null}">All roles</option>
                  <option th:each="r : ${roles}" th:value="${r}" th:text="${r}" th:selected="${role == r}"></option>
                </select>
              </div>
              <div>
                <label class="block text-xs font-medium text-slate-600 mb-1">Status</label>
                <select name="active"
                        class="w-full rounded-xl border border-slate-200 px-3 py-2.5 bg-white
                               focus:outline-none focus:ring-2 focus:ring-slate-300">
                  <option value="" th:selected="${active == null}">All statuses</option>
                  <option value="true" th:selected="${active != null and active}">Active</option>
                  <option value="false" th:selected="${active != null and !active}">Inactive</option>
                </select>
              </div>
              <div class="md:col-span-4 flex flex-wrap gap-2">
                <button class="rounded-xl bg-slate-900 text-white px-4 py-2 text-sm font-semibold hover:bg-slate-800 transition">
                  Apply filters
                </button>
                <a href="/users" class="rounded-xl border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-50 transition">
                  Reset
                </a>
              </div>
            </form>
          </div>

          <div class="rounded-2xl border border-slate-200 bg-white shadow-sm overflow-hidden reveal delay-2">
            <div class="px-6 py-4 border-b border-slate-200 flex flex-wrap items-center justify-between gap-4">
              <div>
                <div class="text-base font-semibold">Users</div>
                <div class="text-sm text-slate-500">Manage roles, permissions, and access flags</div>
              </div>
              <div class="text-sm text-slate-500">
                Page <span class="font-semibold text-slate-900" th:text="${page + 1}">1</span>
                of <span th:text="${totalPages}">1</span>
              </div>
            </div>

            <div class="px-6 py-4 border-b border-slate-200 bg-slate-50/70">
              <form id="bulkForm" action="/users/bulk" method="post" class="grid grid-cols-1 lg:grid-cols-6 gap-3">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <div class="lg:col-span-2">
                  <label class="block text-xs font-medium text-slate-600 mb-1">Bulk action</label>
                  <select id="bulkAction" name="action"
                          class="w-full rounded-xl border border-slate-200 px-3 py-2.5 bg-white
                                 focus:outline-none focus:ring-2 focus:ring-slate-300">
                    <option value="activate">Activate accounts</option>
                    <option value="deactivate">Deactivate accounts</option>
                    <option value="role">Change role</option>
                    <option value="add-perm">Add permission</option>
                    <option value="remove-perm">Remove permission</option>
                    <option value="reset-password">Reset password (temporary)</option>
                    <option value="require-mfa">Require MFA</option>
                    <option value="clear-mfa">Clear MFA requirement</option>
                  </select>
                </div>
                <div id="bulkRoleWrap" class="lg:col-span-1 hidden">
                  <label class="block text-xs font-medium text-slate-600 mb-1">Role</label>
                  <select name="role"
                          class="w-full rounded-xl border border-slate-200 px-3 py-2.5 bg-white
                                 focus:outline-none focus:ring-2 focus:ring-slate-300">
                    <option th:each="r : ${roles}" th:value="${r}" th:text="${r}"></option>
                  </select>
                </div>
                <div id="bulkPermWrap" class="lg:col-span-1 hidden">
                  <label class="block text-xs font-medium text-slate-600 mb-1">Permission</label>
                  <select name="permission"
                          class="w-full rounded-xl border border-slate-200 px-3 py-2.5 bg-white
                                 focus:outline-none focus:ring-2 focus:ring-slate-300">
                    <option th:each="p : ${permissions}" th:value="${p}" th:text="${p}"></option>
                  </select>
                </div>
                <div id="bulkPasswordWrap" class="lg:col-span-1 hidden">
                  <label class="block text-xs font-medium text-slate-600 mb-1">Temp password</label>
                  <input name="password" type="text" autocomplete="off"
                         class="w-full rounded-xl border border-slate-200 px-3 py-2.5 bg-white
                                focus:outline-none focus:ring-2 focus:ring-slate-300"
                         placeholder="Set temp password"/>
                </div>
                <div class="lg:col-span-1 flex items-end">
                  <button class="w-full rounded-xl bg-slate-900 text-white py-2.5 text-sm font-semibold hover:bg-slate-800 transition">
                    Apply
                  </button>
                </div>
                <div class="lg:col-span-6 text-xs text-slate-500">
                  Selected users: <span id="bulkCount" class="font-semibold text-slate-900">0</span>. Bulk actions skip your own account.
                </div>
              </form>
            </div>

            <div class="overflow-x-auto">
              <table class="min-w-full text-sm">
                <thead class="bg-slate-50 text-slate-600">
                  <tr>
                    <th class="text-left px-6 py-3 font-semibold">
                      <input id="selectAll" type="checkbox" class="rounded border-slate-300" />
                    </th>
                    <th class="text-left px-6 py-3 font-semibold">User</th>
                    <th class="text-left px-6 py-3 font-semibold">Status</th>
                    <th class="text-left px-6 py-3 font-semibold">Permissions</th>
                    <th class="text-left px-6 py-3 font-semibold">Last login</th>
                    <th class="text-left px-6 py-3 font-semibold">Actions</th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-slate-100">
                  <tr th:each="u : ${users}" th:with="isSelf=${#authentication != null and #authentication.name != null and #strings.equalsIgnoreCase(#authentication.name, u.username)}">
                    <td class="px-6 py-4">
                      <input type="checkbox" name="ids" th:value="${u.id}" form="bulkForm"
                             th:disabled="${isSelf}" class="rounded border-slate-300" data-user-select />
                    </td>
                    <td class="px-6 py-4">
                      <div class="font-medium text-slate-900" th:text="${u.username}">username</div>
                      <div class="mt-2 flex flex-wrap items-center gap-2">
                        <span class="inline-flex items-center rounded-full px-2.5 py-1 text-xs font-semibold"
                              th:classappend="${u.role.name() == 'ADMIN'} ? ' bg-slate-900 text-white' : (${u.role.name() == 'MANAGER'} ? ' bg-amber-100 text-amber-800' : ' bg-emerald-100 text-emerald-700')"
                              th:text="${u.role}">ROLE</span>
                        <span th:if="${isSelf}"
                              class="inline-flex items-center rounded-full bg-blue-100 px-2 py-0.5 text-[10px] font-semibold text-blue-700">You</span>
                      </div>
                    </td>
                    <td class="px-6 py-4">
                      <span class="inline-flex items-center rounded-full px-2.5 py-1 text-xs font-semibold"
                            th:classappend="${u.active} ? ' bg-emerald-100 text-emerald-700' : ' bg-rose-100 text-rose-700'"
                            th:text="${u.active} ? 'Active' : 'Inactive'">Active</span>
                      <div class="mt-2 flex flex-wrap gap-2 text-xs">
                        <span th:if="${u.mustResetPassword}"
                              class="rounded-full bg-amber-100 px-2 py-0.5 font-semibold text-amber-700">Reset required</span>
                        <span th:if="${u.mfaRequired}"
                              class="rounded-full bg-indigo-100 px-2 py-0.5 font-semibold text-indigo-700">MFA required</span>
                      </div>
                    </td>
                    <td class="px-6 py-4">
                      <div th:if="${u.permissions != null and !u.permissions.isEmpty()}" class="flex flex-wrap gap-1">
                        <span th:each="p : ${u.permissions}"
                              class="rounded-full bg-slate-100 px-2 py-0.5 text-[10px] font-semibold text-slate-700"
                              th:text="${p}">PERMISSION</span>
                      </div>
                      <span th:if="${u.permissions == null or u.permissions.isEmpty()}" class="text-xs text-slate-500">None</span>
                    </td>
                    <td class="px-6 py-4 text-sm text-slate-600">
                      <span th:if="${u.lastLoginAt != null}" th:text="${#temporals.format(u.lastLoginAt, 'yyyy-MM-dd HH:mm')}">2026-02-11 18:00</span>
                      <span th:if="${u.lastLoginAt == null}">Never</span>
                    </td>
                    <td class="px-6 py-4">
                      <details class="group">
                        <summary class="cursor-pointer text-xs font-semibold text-slate-600 hover:text-slate-900">
                          Manage
                        </summary>
                        <div class="mt-3 space-y-3 text-xs">
                          <div th:if="${isSelf}" class="rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-slate-600">
                            Self-management is limited. Use
                            <a href="/users/password" class="font-semibold text-slate-900 hover:underline">your password reset page</a>.
                          </div>

                          <form th:if="${!isSelf}" th:action="@{'/users/' + ${u.id} + '/role'}" method="post" class="flex items-center gap-2">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <select name="role"
                                    class="rounded-lg border border-slate-200 bg-white px-2.5 py-1.5 text-xs
                                           focus:outline-none focus:ring-2 focus:ring-slate-300">
                              <option th:each="r : ${roles}" th:value="${r}" th:text="${r}"
                                      th:selected="${r == u.role}"></option>
                            </select>
                            <button class="rounded-lg border border-slate-200 px-3 py-1.5 text-xs font-semibold hover:bg-slate-50 transition">
                              Update role
                            </button>
                          </form>

                          <form th:if="${!isSelf}" th:action="@{'/users/' + ${u.id} + '/status'}" method="post" class="flex items-center gap-2">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <input type="hidden" name="active" th:value="${!u.active}"/>
                            <button class="rounded-lg border border-slate-200 px-3 py-1.5 text-xs font-semibold hover:bg-slate-50 transition"
                                    th:text="${u.active} ? 'Deactivate' : 'Activate'"></button>
                          </form>

                          <form th:if="${!isSelf}" th:action="@{'/users/' + ${u.id} + '/password'}" method="post" class="grid grid-cols-1 gap-2">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <input name="password" type="password" placeholder="New password"
                                   class="rounded-lg border border-slate-200 bg-white px-2.5 py-1.5 text-xs
                                          focus:outline-none focus:ring-2 focus:ring-slate-300"/>
                            <div class="flex items-center gap-2">
                              <select name="temporary"
                                      class="rounded-lg border border-slate-200 bg-white px-2.5 py-1.5 text-xs
                                             focus:outline-none focus:ring-2 focus:ring-slate-300">
                                <option value="true" selected>Temporary</option>
                                <option value="false">Permanent</option>
                              </select>
                              <button class="rounded-lg border border-slate-200 px-3 py-1.5 text-xs font-semibold hover:bg-slate-50 transition">
                                Reset password
                              </button>
                            </div>
                          </form>

                          <form th:if="${!isSelf}" th:action="@{'/users/' + ${u.id} + '/permissions'}" method="post" class="grid grid-cols-1 gap-2">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <select name="permissions" multiple
                                    class="rounded-lg border border-slate-200 bg-white px-2.5 py-1.5 text-xs h-28
                                           focus:outline-none focus:ring-2 focus:ring-slate-300">
                              <option th:each="p : ${permissions}" th:value="${p}" th:text="${p}"
                                      th:selected="${u.permissions != null and u.permissions.contains(p)}"></option>
                            </select>
                            <button class="rounded-lg border border-slate-200 px-3 py-1.5 text-xs font-semibold hover:bg-slate-50 transition">
                              Save permissions
                            </button>
                          </form>

                          <form th:if="${!isSelf}" th:action="@{'/users/' + ${u.id} + '/mfa'}" method="post" class="flex items-center gap-2">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <input type="hidden" name="required" th:value="${!u.mfaRequired}"/>
                            <button class="rounded-lg border border-slate-200 px-3 py-1.5 text-xs font-semibold hover:bg-slate-50 transition"
                                    th:text="${u.mfaRequired} ? 'Clear MFA' : 'Require MFA'"></button>
                          </form>
                        </div>
                      </details>
                    </td>
                  </tr>
                  <tr th:if="${#lists.isEmpty(users)}">
                    <td colspan="6" class="px-6 py-6 text-center text-slate-500">No users found.</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="px-6 py-4 border-t border-slate-200 flex flex-wrap items-center justify-between gap-3 text-sm text-slate-600">
              <div>
                Showing <span class="font-semibold text-slate-900" th:text="${users.size()}">0</span> users on this page.
              </div>
              <div class="flex items-center gap-2">
                <a th:if="${hasPrev}" th:href="@{/users(page=${prevPage}, q=${q}, role=${role}, active=${active})}"
                   class="rounded-lg border border-slate-200 px-3 py-1.5 hover:bg-slate-50 transition">Previous</a>
                <span class="text-xs text-slate-500">Page <span th:text="${page + 1}">1</span> of <span th:text="${totalPages}">1</span></span>
                <a th:if="${hasNext}" th:href="@{/users(page=${nextPage}, q=${q}, role=${role}, active=${active})}"
                   class="rounded-lg border border-slate-200 px-3 py-1.5 hover:bg-slate-50 transition">Next</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    const selectAll = document.getElementById('selectAll');
    const rowCheckboxes = Array.from(document.querySelectorAll('[data-user-select]'));
    const bulkCount = document.getElementById('bulkCount');
    const bulkAction = document.getElementById('bulkAction');
    const bulkRoleWrap = document.getElementById('bulkRoleWrap');
    const bulkPermWrap = document.getElementById('bulkPermWrap');
    const bulkPasswordWrap = document.getElementById('bulkPasswordWrap');

    /**
     * Executes the updateCount function.
     * @returns {any} Result produced by this function.
     * @throws {Error} May throw runtime errors from DOM, network, or dependency operations.
     * Edge cases: Null, undefined, and empty inputs are handled by the existing implementation.
     */
    const updateCount = () => {
      if (!bulkCount) return;
      const selected = rowCheckboxes.filter((cb) => cb.checked).length;
      bulkCount.textContent = selected.toString();
    };

    /**
     * Executes the updateCount function.
     * @returns {any} Result produced by this function.
     * @throws {Error} May throw runtime errors from DOM, network, or dependency operations.
     * Edge cases: Null, undefined, and empty inputs are handled by the existing implementation.
     */
    /**
     * Executes the updateCount function.
     * @returns {any} Result produced by this function.
     * @throws {Error} May throw runtime errors from DOM, network, or dependency operations.
     * Edge cases: Null, undefined, and empty inputs are handled by the existing implementation.
     */
    if (selectAll) {
      selectAll.addEventListener('change', () => {
        rowCheckboxes.forEach((cb) => {
          if (!cb.disabled) cb.checked = selectAll.checked;
        });
        updateCount();
      });
    }

    rowCheckboxes.forEach((cb) => cb.addEventListener('change', updateCount));
    updateCount();

    /**
     * Executes the syncBulkFields function.
     * @returns {any} Result produced by this function.
     * @throws {Error} May throw runtime errors from DOM, network, or dependency operations.
     * Edge cases: Null, undefined, and empty inputs are handled by the existing implementation.
     */
    const syncBulkFields = () => {
      const action = bulkAction ? bulkAction.value : '';
      const showRole = action === 'role';
      const showPerm = action === 'add-perm' || action === 'remove-perm';
      const showPassword = action === 'reset-password';

    /**
     * Executes the syncBulkFields function.
     * @returns {any} Result produced by this function.
     * @throws {Error} May throw runtime errors from DOM, network, or dependency operations.
     * Edge cases: Null, undefined, and empty inputs are handled by the existing implementation.
     */
    /**
     * Executes the syncBulkFields function.
     * @returns {any} Result produced by this function.
     * @throws {Error} May throw runtime errors from DOM, network, or dependency operations.
     * Edge cases: Null, undefined, and empty inputs are handled by the existing implementation.
     */
      if (bulkRoleWrap) bulkRoleWrap.classList.toggle('hidden', !showRole);
      if (bulkPermWrap) bulkPermWrap.classList.toggle('hidden', !showPerm);
      if (bulkPasswordWrap) bulkPasswordWrap.classList.toggle('hidden', !showPassword);
    };

    if (bulkAction) {
      bulkAction.addEventListener('change', syncBulkFields);
      syncBulkFields();
    }
  </script>
</body>
</html>
